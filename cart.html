<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="css/style.css" />
        <link rel="stylesheet" href="css/cart.css" />
        <link rel="stylesheet" href="css/font-awesome.min.css" />
        <script type="text/javascript" src="items.js"></script>
        <!-- <script type="text/javascript" src="js/slider.js" ></script> -->
        <title>My Cart</title>
    </head>
    <body>
        <div id="navigation-container">
            <div id="navigation-wrap">
                <div id="icon-container" onclick="window.location.href='index.html'"></div>
                <div id="search-container">
                    <div id="cate-container">
                            <div>Search <i class="fa fa-search" aria-hidden="true"></i></div>
                        <!-- <ul id="cate-list">
                            <li></li>
                        </ul> -->
                    </div>
                    <div id="search-bar-bg">
                        <form action="items.html" method="GET">
                            <input id="search-bar" type="text" name="search" placeholder="Search..."/>
                            <button id="submit-button" type="submit"><div>Search <i class="fa fa-search" aria-hidden="true"></i></div></button>
                        </form>
                    </div>
                </div>
                <a href="cart.html" id="cart">
                    <div class="cart-icon"><i class="fa fa-shopping-cart" aria-hidden="true"></i>Cart</div>
                    <div id="cart-items">
                        <div id="cart-items-container"></div>
                        <!-- <div class="cit">
                            <div class="thumb"></div>
                            <div class="cart-info-right">
                                <div class="cart-title">Building Computer V</div>
                                <div class="cart-price">$66.52</div>
                            </div>
                        </div> -->
                        <div onclick="tocart()" id="checkout">Check Out</div>
                    </div>
                    

                </a>
            </div>
            <div id="sub-navi">
                <div id="subnavi-g">
                    <a class="subnavi-item" href="#">Best Sellers</a>
                    <a class="subnavi-item" href="#">Ranks</a>
                    <a class="subnavi-item" href="#">Recommendations</a>
                    <a class="subnavi-item" href="#">New Releases</a>
                    <a class="subnavi-item" href="#">Gift Cards</a>
                </div>
            </div>ss
        </div>
        <div id="nothing">
            <p>There is nothing in your cart! <br>Come <a href="items.html">here</a> to shop!</p>
        </div>
        <div id="main-container">
            <div id="main-wrap">
                
                <div id="main-wrapper">
                  <ul id="cart-list">
                    <!-- <li class="cart-item-main" draggable="true">
                      <div class="dst"></div>
                      <div class="thumbnail"></div>
                      <div class="cart-item-right">
                        <div class="detail-title">Building Computer Vision Projects with OpenCV 4 and C++: Implement complex computer vision algorithms and explore deep learning and face detection<br />
                          <div class="detail-info">Author: John Titor<br />Publish: 2018</div>
                          <div class="review"></div>
                        </div>
                        
                        <div class="amount"><div class="minor bt">-</div><div class="cart-amount">1</div><div class="plus bt">+</div></div>
                        <div class="single-price">66.25</div>
                      </div>
                      
                      
                    </li> -->
                  </ul>
                  <div id="bottom-panel">
                    <div id="clear">Clear</div>
                    <div id="confirmpay">Confirm</div>
                    <div>Total:<span id="total">66.25</span></div>
                  </div>
                </div>
                <div id="brand">
                    <div class="section-title">Brand Recommendations</div>
                    <div id="brand-wrapper">
                        <div class="brand-row">
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                        </div>
                        <div class="brand-row">
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                            <div class="brand-img"><div></div></div>
                        </div>
                    </div>
                </div>
                <div id="reco">
                    <div class="section-title">Daily Recommendations</div>
                    <div id="reco-wrapper">
                        <div id="reco-left"></div>
                        <div id="reco-right">
                            <div id="reco-top">
                                <div class="reco-item"></div>
                                <div class="reco-item"></div>
                            </div>
                            <div id="reco-bottom">
                                <div class="reco-item"></div>
                                <div class="reco-item"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <div id="footer-container">
                <div id="footer-wrapper">
                    <div id="about-us" class="footer-col">
                        <div class="footer-title">About Us</div>
                        <ul class="footer-ul">
                            <li class="footer-li"><a href="#">Customer Service</a></li>
                            <li class="footer-li"><a href="#">Advanced Search</a></li>
                            <li class="footer-li"><a href="#">Order and Returns</a></li>
                            <li class="footer-li"><a href="#">Contact Us</a></li>
                        </ul>
                        
                    </div>
                    <div id="policy" class="footer-col">
                        <div class="footer-title">Policy</div>
                        <ul class="footer-ul">
                            <li class="footer-li"><a href="#">Privacy Policy</a></li>
                            <li class="footer-li"><a href="#">Site Map</a></li>
                            <li class="footer-li"><a href="#">Search Term</a></li>
                            <li class="footer-li"><a href="#">Customer Service</a></li>
                        </ul>
                        
                    </div>
                    <div id="account" class="footer-col">
                        <div class="footer-title">Account</div>
                        <ul class="footer-ul">
                            <li class="footer-li"><a href="#">Sign In</a></li>
                            <li class="footer-li"><a href="#">Sign Up</a></li>
                            <li class="footer-li"><a href="#">View Cart</a></li>
                            <li class="footer-li"><a href="#">Help</a></li>
                        </ul>
                        
                    </div>
                    <div id="contact" class="footer-col">
                        <div class="footer-title">Contact</div>
                        <ul class="footer-ul">
                            <li class="footer-li"><a href="#"><i class="fa fa-envelope yellow" aria-hidden="true"></i>  Email: jecosine@outlook.com</a></li>
                            <li class="footer-li"><a href="#"><a href="#"><i class="fa fa-phone yellow" aria-hidden="true"></i> Tele: 123-45678901</a></li>
                            <li class="footer-li"><a href="#">
                                <a href="#"><i class="fa fa-twitter yellow-l" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-skype yellow-l" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-facebook yellow-l" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-linkedin yellow-l" aria-hidden="true"></i></a>
        
                            </li>
                            
                            
                        </ul>
                    </div>
                    
                </div>
            </div>
    </body>
    <script>
        var itemslist = itemsdata['dt'];
        var bt = document.getElementById("total");
        // load brand
        var brands = document.getElementsByClassName("brand-img");
        for (var i = 0;i < 12;i++){
            brands[i].getElementsByTagName("div")[0].setAttribute("style","background-image:url(./images/brand/"+(i+1)+".webp)");
        }
        // load cart
        var s = localStorage.getItem("cart");
        s = JSON.parse(s);
        if(s != null){
          refreshCart();
          sumprice();
           var cart = document.getElementById("cart-items-container");
            for(var i = 0; i < s['items'].length; i++){
                var t = document.createElement("div");
                t.classList.add("cit");
                t.innerHTML = '<div class="thumb" style="background-size:cover;background-image: url(./images/items/'+itemslist[s['items'][i]['id']]['imurl']+')"></div><div class="cart-info-right"><div class="cart-title">' + itemslist[s['items'][i]['id']]['title'].slice(0,30) + '</div><div class="cart-price">'+itemslist[s['items'][i]['id']]['price']+'</div></div>'
                cart.appendChild(t);
            }
        }
        var cartItems = document.getElementById("cart-list").children;
        var s = localStorage.getItem("cart");
        s = JSON.parse(s);
        for(var i = 0;i < s['items'].length; i++){
          var m = cartItems[i].getElementsByClassName("minor")[0];
          var p = cartItems[i].getElementsByClassName("plus")[0];
          var d = cartItems[i].getElementsByClassName("dst")[0];
          cartItems[i].getElementsByClassName("thumbnail")[0].ondragstart=function(e){
            var id = this.parentNode.getElementsByClassName("amount")[0].dataset['id'];
            e.dataTransfer.setData("id", id);
            this.parentNode.getElementsByClassName("dst")[0].style.display = "inline-block";
            this.parentNode.getElementsByClassName("dst")[0].getElementsByTagName("i")[0].style.animation="jump infinite 1s";
          }
          cartItems[i].getElementsByClassName("thumbnail")[0].ondragend = function(){
            this.parentNode.getElementsByClassName("dst")[0].style.display = "none";
            this.parentNode.getElementsByClassName("dst")[0].getElementsByTagName("i")[0].style.animation="none";
          }
          cartItems[i].getElementsByClassName("thumbnail")[0].ondragover = function(e){
            e.preventDefault();
          }
          cartItems[i].getElementsByClassName("dst")[0].ondragover=function(e){
            e.preventDefault();
          }
          cartItems[i].getElementsByClassName("dst")[0].ondrop=function(e){
            var id = parseInt(e.dataTransfer.getData("id"));
            console.log("kill ", id);
            s['items'].splice(id,1);
            localStorage.setItem("cart",JSON.stringify(s));
            refreshCart();
            sumprice();
          }
          m.onclick = function(){            
            console.log("clicked: ",id);
            var a = this.parentNode.getElementsByClassName("cart-amount")[0];
            var id = parseInt(a.parentNode.dataset['id']);
            a.innerHTML = (parseInt(a.innerHTML)>0?parseInt(a.innerHTML) - 1:0).toString();
            if (a.innerHTML == "0"){
              s['items'].splice(id,1);
            }
            else{
              s['items'][id]['amount'] = a.innerHTML;
            }
            localStorage.setItem("cart", JSON.stringify(s));
            // refreshCart();
            sumprice();
          }
          p.onclick = function(){            
            var a = this.parentNode.getElementsByClassName("cart-amount")[0];
            var id = parseInt(a.parentNode.dataset['id']);
            a.innerHTML = (parseInt(a.innerHTML) + 1).toString();
            s['items'][id]['amount'] = a.innerHTML;
            localStorage.setItem("cart", JSON.stringify(s));
            // refreshCart();
            sumprice();
          }
        }
        
        function refreshCart(){
          var s = localStorage.getItem("cart");
          s = JSON.parse(s);
          if (s != null){
            var cart = document.getElementById("cart-list");
            cart.innerHTML="";
            for(var i = 0; i < s['items'].length; i++){
                var t = document.createElement("li");
                var dt = s['items'][i];
                t.classList.add("cart-item-main");
                console.log(dt);
                
                t.innerHTML = `<div class="dst"><i class="fa fa-trash" aria-hidden="true"></i></div>
                    <div class="thumbnail" style="background-image: url(./images/items/`+dt['imurl']+`)"></div>
                    <div class="cart-item-right">
                      <div class="detail-title">`+dt['title']+`<br />
                        <div class="detail-info">Author: John Titor<br />Publish: 2018</div>
                        <!-- <div class="review"></div> -->
                      </div>
                      
                      <div class="amount" data-id="`+ i +`"><div class="minor bt">-</div><div class="cart-amount">`+dt['amount']+`</div><div class="plus bt">+</div></div>
                      <div class="single-price">`+dt['price']+`</div>
                    </div>`;
                t.getElementsByClassName("thumbnail")[0].draggable = true;
                cart.appendChild(t);
            }
            var cartItems = document.getElementById("cart-list").children;
            // var s = localStorage.getItem("cart");
            // s = JSON.parse(s);
            for(var i = 0;i < s['items'].length; i++){
              var m = cartItems[i].getElementsByClassName("minor")[0];
              var p = cartItems[i].getElementsByClassName("plus")[0];
              var d = cartItems[i].getElementsByClassName("dst")[0];
              cartItems[i].ondragstart=function(e){
                var id = this.getElementsByClassName("amount")[0].dataset['id'];
                e.dataTransfer.setData("id", id);
                this.getElementsByClassName("dst")[0].style.display = "inline-block";
              }
              cartItems[i].ondragend = function(){
                this.getElementsByClassName("dst")[0].style.display = "none";
              }
              cartItems[i].ondragover = function(e){
                e.preventDefault();
              }
              cartItems[i].getElementsByClassName("dst")[0].ondragover=function(e){
                e.preventDefault();
              }
              cartItems[i].getElementsByClassName("dst")[0].ondrop=function(e){
                var id = parseInt(e.dataTransfer.getData("id"));
                console.log("kill ", id);
                s['items'].splice(id,1);
                localStorage.setItem("cart",JSON.stringify(s));
                refreshCart();
                sumprice();
              }
              m.onclick = function(){
                
                console.log("clicked: ",id);
                var a = this.parentNode.getElementsByClassName("cart-amount")[0];
                var id = parseInt(a.parentNode.dataset['id']);
                a.innerHTML = (parseInt(a.innerHTML)>0?parseInt(a.innerHTML) - 1:0).toString();
                if (a.innerHTML == "0"){
                  s['items'].splice(id,1);
                }
                else{
                  s['items'][id]['amount'] = a.innerHTML;
                }
                localStorage.setItem("cart", JSON.stringify(s));
                sumprice();
                // refreshCart();
              }
              p.onclick = function(){
                
                var a = this.parentNode.getElementsByClassName("cart-amount")[0];
                var id = parseInt(a.parentNode.dataset['id']);
                a.innerHTML = (parseInt(a.innerHTML) + 1).toString();
                s['items'][id]['amount'] = a.innerHTML;
                localStorage.setItem("cart", JSON.stringify(s));
                // refreshCart();
                sumprice();
              }
            }
          
            // return;
            
          }

        }
        // clear all btn
        var clearbtn = document.getElementById("clear");
        clearbtn.onclick = function(){
            cart.innerHTML = "";
            s["items"] = [];
            s["count"] = 0;
            s["total"] = 0;
            localStorage.setItem("cart", JSON.stringify(s));
            window.location.href = "cart.html";
        }
        function sumprice(){
          var sum = 0;
          for(var i = 0 ; i < s['items'].length; i++){
            sum += parseFloat(s['items'][i]['price'])* parseFloat(s['items'][i]['amount']);
          }
          bt.innerHTML = sum.toFixed(2).toString();
        }
    </script>
    
</html>