<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/item.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <script type="text/javascript" src="items.js"></script>
  </head>
  <body>
    <div id="navigation-container">
      <div id="navigation-wrap">
        <a href="index.html" id="icon-container"></a>
        <div id="search-container">
          <div id="cate-container">
              <div>Search <i class="fa fa-search" aria-hidden="true"></i></div>
            <!-- <ul id="cate-list">
              <li></li>
            </ul> -->
          </div>
          <div id="search-bar-bg">
            <form action="banana.jsp" method="GET">
              <input id="search-bar" type="text" name="search" placeholder="Search..."/>
              <button id="submit-button" type="submit"><div>Search <i class="fa fa-search" aria-hidden="true"></i></div></button>
            </form>
          </div>
        </div>
        <!-- <a href="#" id="cart"><div><i class="fa fa-shopping-cart" aria-hidden="true"></i>Cart</div></a> -->
        <a href="#" id="cart">
          <div class="cart-icon"><i class="fa fa-shopping-cart" aria-hidden="true"></i>Cart</div>
          <div id="cart-items">
              <!-- <div class="cit">
                  <div class="thumb"></div>
                  <div class="cart-info-right">
                      <div class="cart-title">Building Computer V</div>
                      <div class="cart-price">$66.52</div>
                  </div>
              </div> -->
          </div>

      </a>        
      </div>
      <div id="sub-navi">
        <div id="subnavi-g">
          <a class="subnavi-item" href="#">Best Sellers</a>
          <a class="subnavi-item" href="#">Ranks</a>
          <a class="subnavi-item" href="#">Recommendations</a>
          <a class="subnavi-item" href="#">New Releases</a>
          <a class="subnavi-item" href="#">Gift Cards</a>
        </div>
      </div>
    </div>
    <div id="main-container">
      <div id="main-wrap">       
        <div id="main-wrapper">
          <div id="filter"></div>
          <div id="item-list">
            <!-- <div class="item-container" title="Drag me to cart">
              <div class="item-wrap" id="test" draggable="true">
                <div class="item-cover"></div>
                <div class="item-info">
                  <div class="item-upper">
                    <div class="item-title">C++ Primer Plus (6th ver.)</div>
                    <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                    <div class="item-sells">200</div>
                  </div>
                  <div class="item-bottom">
                    <div class="item-price">￥69.84</div>
                    <div class="item-icons"></div>
                  </div>
                </div>
              </div>
              <div class="it-cart">
                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>
              </div>
            </div> 
            <div class="item-container">
              <div class="item-wrap">
                <div class="item-cover"></div>
                <div class="item-info">
                  <div class="item-upper">
                    <div class="item-title">C++ Primer Plus (6th ver.)</div>
                    <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                    <div class="item-sells">200</div>
                  </div>
                  <div class="item-bottom">
                    <div class="item-price">￥69.84</div>
                    <div class="item-icons"></div>
                  </div>
                </div>
              </div>
            </div> 
            <div class="item-container">
              <div class="item-wrap">
                <div class="item-cover"></div>
                <div class="item-info">
                  <div class="item-upper">
                    <div class="item-title">C++ Primer Plus (6th ver.)</div>
                    <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                    <div class="item-sells">200</div>
                  </div>
                  <div class="item-bottom">
                    <div class="item-price">￥69.84</div>
                    <div class="item-icons"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="item-container">
              <div class="item-wrap">
                <div class="item-cover"></div>
                <div class="item-info">
                  <div class="item-upper">
                    <div class="item-title">C++ Primer Plus (6th ver.)</div>
                    <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                    <div class="item-sells">200</div>
                  </div>
                  <div class="item-bottom">
                    <div class="item-price">￥69.84</div>
                    <div class="item-icons"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="item-container">
                <div class="item-wrap">
                    <div class="item-cover"></div>
                    <div class="item-info">
                    <div class="item-upper">
                        <div class="item-title">C++ Primer Plus (6th ver.)</div>
                        <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                        <div class="item-sells">200</div>
                    </div>
                    <div class="item-bottom">
                        <div class="item-price">￥69.84</div>
                        <div class="item-icons"></div>
                    </div>
                    </div>
                </div>
                </div> 
            <div class="item-container">
                <div class="item-wrap">
                    <div class="item-cover"></div>
                    <div class="item-info">
                    <div class="item-upper">
                        <div class="item-title">C++ Primer Plus (6th ver.)</div>
                        <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                        <div class="item-sells">200</div>
                    </div>
                    <div class="item-bottom">
                        <div class="item-price">￥69.84</div>
                        <div class="item-icons"></div>
                    </div>
                    </div>
                </div>
                </div> 
            <div class="item-container">
                <div class="item-wrap">
                    <div class="item-cover"></div>
                    <div class="item-info">
                    <div class="item-upper">
                        <div class="item-title">C++ Primer Plus (6th ver.)</div>
                        <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                        <div class="item-sells">200</div>
                    </div>
                    <div class="item-bottom">
                        <div class="item-price">￥69.84</div>
                        <div class="item-icons"></div>
                    </div>
                    </div>
                </div>
                </div>
            <div class="item-container">
                <div class="item-wrap">
                    <div class="item-cover"></div>
                    <div class="item-info">
                    <div class="item-upper">
                        <div class="item-title">C++ Primer Plus (6th ver.)</div>
                        <div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>
                        <div class="item-sells">200</div>
                    </div>
                    <div class="item-bottom">
                        <div class="item-price">￥69.84</div>
                        <div class="item-icons"></div>
                    </div>
                    </div>
                </div>
            </div>             -->
          </div>
                   
          
        </div>
      </div>


    </div>
    <div id="footer-container">
      <div id="footer-wrapper">
        <div id="about-us" class="footer-col">
          <div class="footer-title">About Us</div>
          <ul class="footer-ul">
            <li class="footer-li"><a href="#">Customer Service</a></li>
            <li class="footer-li"><a href="#">Advanced Search</a></li>
            <li class="footer-li"><a href="#">Order and Returns</a></li>
            <li class="footer-li"><a href="#">Contact Us</a></li>
          </ul>
          
        </div>
        <div id="policy" class="footer-col">
          <div class="footer-title">Policy</div>
          <ul class="footer-ul">
            <li class="footer-li"><a href="#">Privacy Policy</a></li>
            <li class="footer-li"><a href="#">Site Map</a></li>
            <li class="footer-li"><a href="#">Search Term</a></li>
            <li class="footer-li"><a href="#">Customer Service</a></li>
          </ul>
          
        </div>
        <div id="account" class="footer-col">
          <div class="footer-title">Account</div>
          <ul class="footer-ul">
            <li class="footer-li"><a href="#">Sign In</a></li>
            <li class="footer-li"><a href="#">Sign Up</a></li>
            <li class="footer-li"><a href="#">View Cart</a></li>
            <li class="footer-li"><a href="#">Help</a></li>
          </ul>
          
        </div>
        <div id="contact" class="footer-col">
          <div class="footer-title">Contact</div>
          <ul class="footer-ul">
            <li class="footer-li"><a href="#"><i class="fa fa-envelope yellow" aria-hidden="true"></i>  Email: jecosine@outlook.com</a></li>
            <li class="footer-li"><a href="#"><a href="#"><i class="fa fa-phone yellow" aria-hidden="true"></i> Tele: 123-45678901</a></li>
            <li class="footer-li"><a href="#">
              <a href="#"><i class="fa fa-twitter yellow-l" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-skype yellow-l" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-facebook yellow-l" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-linkedin yellow-l" aria-hidden="true"></i></a>
  
            </li>
            
            
          </ul>
        </div>
        
      </div>
    </div>
  </body>
  <script>
    var itemslist = itemsdata['dt'];
    // load cart
    var s = localStorage.getItem("cart");
        s = JSON.parse(s);
        if (s != null){
            // return;
            var cart = document.getElementById("cart-items");
            for(var i = 0; i < s['items'].length; i++){
                var t = document.createElement("div");
                t.classList.add("cit");
                t.innerHTML = '<div class="thumb" style="background-size:cover;background: url(./images/items/'+itemslist[s['items'][i]['id']]['imurl']+')"></div><div class="cart-info-right"><div class="cart-title">' + itemslist[s['items'][i]['id']]['title'].slice(0,30) + '</div><div class="cart-price">'+itemslist[s['items'][i]['id']]['price']+'</div></div>'
                cart.appendChild(t);
            }
        }
    var pivot = document.getElementById("item-list");
    var cart_dom = document.getElementById("cart");
    for(var i = 0; i < itemslist.length; i++){
        var t = document.createElement("div");
        t.innerHTML = '<div class="item-wrap" data-id="'+i+'" draggable="true">'+
                '<div class="item-cover" style="background-image: url(./images/items/' + itemslist[i]['imurl']+')"></div>'+
                '<div class="item-info">'+
                  '<div class="item-upper">'+
                    '<div class="item-title">'+ itemslist[i]['title'].slice(0,20) + '...</div>'+
                    '<div class="item-seller"><a href="#"><i class="fa fa-newspaper-o" aria-hidden="true"></i>People post Press</a></div>'+
                    '<div class="item-sells">' + Math.floor(Math.random()*200) +'</div>'+
                  '</div>'+
                  '<div class="item-bottom">'+
                    '<div class="item-price">￥'+ itemslist[i]['price'] +'</div>'+
                    '<div class="item-icons"></div>'+
                  '</div>'+
                '</div>'+
              '</div>';
        t.classList.add("item-container");
        t.title = "Drag me to cart!";
        // t.draggable = true;
        // var t = document.getElementById("test");
        var c = document.createElement("div");
        c.classList.add("it-cart");
        c.innerHTML = "<i class=\"fa fa-shopping-cart\" aria-hidden=\"true\"></i>";
        t.appendChild(c);
        pivot.appendChild(t);
        
        var t = pivot.children[i];
        var c = t.getElementsByClassName("it-cart")[0];
        t.ondragstart=function(e){
            // console.log("start dragging");
            // console.log(e.offsetX, e.offsetY);       
            this.getElementsByClassName("it-cart")[0].style.display = "inline-block";
            var temp = this.getElementsByClassName("item-wrap")[0].dataset["id"];
            e.dataTransfer.setData("dt",temp);
        }
        t.ondragend=function(e){
            // console.log("dragging end");
            this.getElementsByClassName("it-cart")[0].style.display = "none";
        }
        c.ondrop=function(e){
            console.log("in real");
            // e.preventDefault();
            var temp = e.dataTransfer.getData("dt");
            console.log(e.dataTransfer.getData("dt"));
            addtoCart(temp);
            cart_dom.style.animation = "spike 1s";
            setTimeout(()=>{
                cart_dom.style.animation = "none";
            }, 1000);
            
        }
        c.ondragenter=function(e){
            // console.log("entered");
            this.style.opacity = 1;
        }
        t.ondragover=function(e){
            e.preventDefault();
            // console.log("in over");
        }
        c.ondragover=function(e){
            e.preventDefault();
            // console.log("in over");
        }
        c.ondragleave=function(e){
            this.style.opacity = 0.8;
        }
        function addtoCart(id){
            // cart is empty or not
            var s = localStorage.getItem("cart");
            var amount = 1;
            if (s == null){     
                s = {"items":[], "total": 0, "count": 1};     
                var pattern = JSON.parse(JSON.stringify(itemslist[id]));
                pattern['id'] = id;
                pattern["amount"] = "1";
                s['items'].push(pattern);      
                localStorage.setItem("cart",JSON.stringify(s));
                
            } else {
                s = JSON.parse(s);
                var flag = false;
                for(var i = 0; i < s["items"].length; i++){
                    if(s['items'][i]["id"] == id) {
                        s['items'][i]["amount"] = (parseInt(s['items'][i]["amount"]) + 1).toString();
                        s['total'] += parseFloat(s['items'][i]['price']);
                        flag = true;
                    }
                }
                if (!flag){
                    var pattern = JSON.parse(JSON.stringify(itemslist[id]));
                    pattern['id'] = id;
                    pattern["amount"] = "1";
                    s["total"] += parseFloat(itemslist[id]["price"]);
                    s['items'].push(pattern);
                    

                }
                s["count"] += 1;
                localStorage.setItem("cart",JSON.stringify(s));
            }
            
            

        }
        
        
    }    
    
    
  </script>

</html>